@using VocaDb.Web.Helpers

<div data-bind="with: selectedTopic()">
	
	<div data-bind="visible: !isBeingEdited()">
		
		<div class="well well-transparent">
			<h3 data-bind="text: contract().name"></h3>

			<div data-bind="with: contract">
				@CommentHelpers.CommentBodyKnockout("content", true, "$parents[1].deleteTopic", "$parent.beginEditTopic")
			</div>

		</div>
		
		@if (Login.CanManageDb) {
			<div class="well well-transparent">
				<form data-bind="submit: createComment">
					<textarea data-bind="textInput: newComment" rows="6" cols="60" maxlength="800" class="span5" placeholder="@ViewRes.DiscussionContentStrings.NewComment" required></textarea>
					<button type="submit" class="btn btn-primary">@ViewRes.DiscussionContentStrings.AddComment</button>
				</form>
			</div>
		}

		<div data-bind="foreach: comments">
			<div class="well well-transparent">
				<div data-bind="visible: $parent.editCommentModel() !== $data">
					@CommentHelpers.CommentBodyKnockout("message", false, editHandler: "$parent.beginEditComment")					
				</div>
				<form data-bind="visible: $parent.editCommentModel() === $data, submit: $parent.saveEditedComment">
					<textarea data-bind="textInput: editedMessage" rows="6" cols="60" maxlength="800" class="span5" required></textarea>
					<button type="submit" class="btn btn-primary">@ViewRes.SharedStrings.Save</button>
					<button data-bind="click: $parent.cancelEditComment" class="btn">Cancel</button>
				</form>					
			</div>
		</div>

	</div>
	
	<form data-bind="visible: isBeingEdited, submit: saveEditedTopic" class="well well-transparent">
		<div data-bind="with: editModel">
			@{ Html.RenderPartial("Partials/_EditTopic"); }
		</div>
		<button type="submit" class="btn btn-primary">Save</button>
		<button data-bind="click: cancelEdit" class="btn">Cancel</button>
	</form>

</div>
