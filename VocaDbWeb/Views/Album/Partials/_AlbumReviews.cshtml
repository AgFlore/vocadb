@using VocaDb.Model.Domain.Globalization
@using VocaDb.Web.Helpers
@inherits VocaDb.Web.Code.VocaDbPage

<!-- Viewmodel: AlbumReviewsViewModel -->

<button data-bind="visible: !showCreateNewReview(), click: function() { showCreateNewReview(true); }" class="btn create-topic">
	<i class="icon-comment"></i>
	Write review
</button>

<form visible="{{showCreateNewReview}}" submit="{{createNewReview}}">
	<div>
		<label>Language</label>
		@KnockoutHelpers.DropdownList(InterfaceLanguage.UserLanguageCultures.ToDictionaryFull("Choose"), "languageCode", cssClass: "input-xlarge", required: true)

		<div class="alert alert-danger" visible="{{reviewAlreadySubmitted}}">
			You have already submitted a review in this language. Multiple reviews in the same language are not allowed.
		</div>

		<label>Title (optional)</label>
		<input data-bind="textInput: newReviewTitle" type="text" class="input-xlarge" maxlength="200"/>

		<label>Review</label>
		@Helpers.MarkdownNotice()<br />
		<textarea data-bind="textInput: newReviewText" class="input-xxlarge" cols="100" rows="6" maxlength="4000" required></textarea>
		
		<div>
			<label>Preview</label>
			<div data-bind="markdown: newReviewText"></div>
		</div>
	</div>

	<button type="submit" class="btn btn-primary" enabled="{{ !reviewAlreadySubmitted() }}">Post</button>
</form>

<div data-bind="foreach: reviews" class="album-reviews">
	<div class="album-review media">
		@UserHelpers.IconAndLinkKnockout("user", "pull-left")

		<div class="media-body">
			<div class="pull-right">
				<img src="{{ '@Url.StaticResource("/img/languageFlags/")' + languageCode + '.png' }}" title="{{languageCode}}"/>
				|
				<span data-bind="timeAgo: date"></span>
			</div>
			<h3 class="media-heading">{{user.name}}</h3>
			
			<span data-bind="foreach: $parent.ratingStars($parent.getRatingForUser(user.id))">
				<img data-bind="attr: { src: enabled ? '/Content/star.png' : '/Content/star_disabled.png' }" />
			</span>

			<h4 class="album-review-title" visible="{{title}}">{{title}}</h4>
			
			<!-- TODO: review score -->
			<p data-bind="markdown: text"></p>
		</div>
	</div>
</div>
