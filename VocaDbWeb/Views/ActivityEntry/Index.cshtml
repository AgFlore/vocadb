@using VocaDb.Web.Helpers
@inherits VocaDb.Web.Code.VocaDbPage<VocaDb.Model.DataContracts.Activityfeed.ActivityEntryContract[]>

@{
	PageProperties.Title = "Recent activity";
	var lastEntryDate = (DateTime?)ViewBag.LastEntryDate;
}

<ul class="nav nav-pills">
	<li class="active">
		@Html.ActionLink("All activity", "Index")
	</li>
	@if (Login.IsLoggedIn) {
		<li>
			@Html.ActionLink("Only followed artists", "FollowedArtistActivity")
		</li>
	}
</ul>

<input type="hidden" id="lastEntryDate" value='@(lastEntryDate != null ? lastEntryDate.Value.ToString("u") : "null")' />

<div id="entries">
	@{ Html.RenderPartial("_DetailedPage", Model); }
</div>

<hr />
<h3>
	<a href="#" id="loadMoreLink">View more</a>
</h3>

@section BodyScripts {
	<script type="text/javascript">

		$(function () {
			$("#loadMoreLink").click(function () {
				var date = new Date($("#lastEntryDate").val());
				var before = $("#lastEntryDate").val() ? date.toISOString() : null;
				$.get("ActivityEntry/DetailedPage", { before: before }, function (result) {
					$("#entries").append(result.viewHtml);
					$("#lastEntryDate").val(result.lastEntryDate);
				});
				return false;
			});
		});

	</script>
}