@using System.Web.Optimization
@using VocaDb.Web.Helpers;
@inherits VocaDb.Web.Code.VocaDbPage<VocaDb.Web.Models.Event.EventEdit>

@{

	var isNew = (Model.Id == 0);
	string backAction;

	if (!isNew) {
		PageProperties.Title = "Edit event - " + Model.OldName;
		backAction = Url.Action("Details", new { id = Model.Id });
		ViewBag.Parents = new[] {
			Html.ActionLink("Events", "EventsBySeries"),
			Html.ActionLink(Model.OldName, "Details", new { id = Model.Id })
		};
	} else {
		PageProperties.Title = "Create a new event";
		backAction = Url.Action("EventsBySeries");
		ViewBag.Parents = new[] {
			Html.ActionLink("Events", "EventsBySeries")
		};
	}

}

@section Toolbar {
	@if (!isNew && Login.CanDeleteEntries) {
		@Html.ActionLink("Delete", "Delete", new { id = Model.Id }, new { id = "deleteLink", onclick = "return confirm(\"Are you sure you want to delete this event?\");" })
	}
}

@Helpers.ValidationSymmaryPanel("Unable to save properties.")

<form method="POST" data-bind="submit: submit">
	@Html.HiddenFor(m => m.Id)

	@Helpers.SaveAndBackBtn(backAction)

	@if (Model.SeriesId == null) {
		@Html.HiddenFor(m => m.SeriesNumber)

		<div class="editor-label">
			@Html.LabelFor(m => m.Name)
		</div>
		<div class="editor-field">
			@Html.TextBoxFor(m => m.Name, new { size = 40, @class = "span3", maxlength = 50 })<br />
			@Html.ValidationMessageFor(m => m.Name)
		</div>
	} else {
		@Html.HiddenFor(m => m.Name)
		@Html.HiddenFor(m => m.SeriesId)
		@Html.HiddenFor(m => m.SeriesName)
		
		<p>Series: @Model.SeriesName</p>
		<div class="editor-label">
			@Html.LabelFor(m => m.SeriesNumber)
		</div>
		<div class="editor-field">
			@Html.TextBoxFor(m => m.SeriesNumber, new { size = 20 })<br />
			@Html.ValidationMessageFor(m => m.SeriesNumber)
		</div>

		<div class="editor-label">
			@Html.LabelFor(m => m.SeriesSuffix)
		</div>
		<div class="editor-field">
			@Html.TextBoxFor(m => m.SeriesSuffix, new { size = 20 })<br />
		</div>
	}

	<div class="editor-label">
		@Html.LabelFor(m => m.Description)
	</div>
	<div class="editor-field">
		@Html.TextAreaForKnockout(m => m.Description, "initialValue, textInput: description", cols: 60, rows: 4, @cssClass: "span4", maxLength: 400)
		
		Live preview
		<div data-bind="markdown: description"></div>
	</div>
		
	<div class="editor-label">
		@Html.LabelFor(m => m.Date)
	</div>
	<div class="editor-field">
		<input type="text" data-bind="datepicker: { value: date, dateFormat: 'yy-mm-dd' }" class="span2" maxlength="10" />
		@Html.HiddenForKnockout(m => m.Date, "value: ko.toJSON(dateStr)")
		@Html.ValidationMessageFor(m => m.Date)
	</div>
	
	<br />
	@Helpers.SaveAndBackBtn(backAction)
	
</form>

@section BodyScripts {
@Scripts.Render("~/bundles/shared/edit", "~/bundles/ReleaseEvent/Edit")
<script type="text/javascript">
	$(function () {

		var vm = new vdb.viewModels.releaseEvents.ReleaseEventEditViewModel(@ToJS(Model.Date));
		ko.applyBindings(vm);

		initPage();

	});
</script>
}